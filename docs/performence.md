# 性能数据

测试环境：

x86：supermicro sys-1019s-MCOT Inter(R) Xeon(R) CPU E3-1280 v6 @ 3.90GHz

arm：TaiShan 2280 V2 CPU鲲鹏920

## 一、创建/销毁enclave
分别在sgx以及trustzone环境下进行测试，数据为100次创建enclave耗时的均值。

|             |Create enclave|Destroy enclave|
|-------------|--------------|---------------|
|sgx(us)      |19571.17      |657.89         |
|trustzone(us)|9465.71       |526.67         |

## 二、安全侧与非安全侧的计算性能对比

测试方法：生成1GB的随机数据，在REE侧和TEE侧分别对1GB数据计算sha256，分别统计用时，得出数据吞吐量。

sgx：
|              |host    |enclave   |
|--------------|--------|-------   |
|1GB数据耗时(s) |5.884516|14.039993|
|吞吐量(MB/s)   |174.016 |72.935   |
|性能比         |100%    |41.9%    |

arm：
|              |host    |enclave   |
|--------------|--------|-------   |
|1GB数据耗时(s) |10.620642|25.742336|
|吞吐量(MB/s)   |96.416 |39.779   |
|性能比         |100%   |41.3%    |

## 三、常用密码学算法的性能开销

### 对称加解密

针对在host侧和enclave侧的aes-gcm-256算法加密和解密的时间开销，分别在x86和arm架构下进行测试，使用的是openssl提供的加解密库，字符串长度为23字节，测试数据数据为单纯计算能力的比较，不包含host和enclave交互时间。

sgx：
|           |加密|解密|
|-----------|----|---|
|host（us） |1.6|0.6|
|enclave(us)|2.5|1.9|
|性能（enclave/host）|64%|32%|

trustzone:
|           |加密|解密|
|-----------|----|---|
|host（us） |2.7|0.8|
|enclave(us)|13.5|2.1|
|性能（enclave/host）|20%|38%|

### 非对称加解密：
针对在非安全侧运行和安全侧和非安全侧交互的RSA算法，生成密钥、解密、签名的时间开销，使用的是长度为23字节的字符串，使用的是openssl提供的加解密库，分别在x86和arm架构下进行测试，数据为单纯计算能力的比较，不包含host和enclave交互时间。

sgx：
|           |生成秘钥|加密|解密|
|-----------|-------|----|---|
|host（us） |164945.4|2203.0|1533.1|
|enclave(us)|326561.6|4934.9|3926.6|
|性能（enclave/host）|51%|44%|39%|

trustzone
|           |生成秘钥|加密|解密|
|-----------|-------|----|---|
|host（us） |241200.0|4952.4|3812.3|
|enclave(us)|428364.3|5545.5|4215.5|
|性能（enclave/host）|56%|89%|90%|

## example应用时间消耗对比
针对secgear_helloworld和secgear_crypto，在host侧编写相同功能的代码并且只在host侧运行，使用与原程序相同的编译选项编译比如优化级别等，分别命名为helloworld和crypto，每个程序都运行50次，使用time计算每次的运行时间和内存消耗，详细结果如下。

sgx：
|          |helloworld|secgear_helloworld|crypto |secgear_crypto|
|----------|----------|------------------|-------|--------------|
|cpu(s)    |0.001     |0.02              |0.207  |0.307         |
|memory(kb)|1256.96   |6444.56           |4165.76|10203.52      |

trustzone:
|          |helloworld|secgear_helloworld|crypto |secgear_crypto|
|----------|----------|------------------|-------|--------------|
|cpu(s)    |0.001     |0.028             |0.319  |0.414         |
|memory(kb)|1543.68   |3336.96           |4807.68|5392.64       |

无论在sgx还是trustzone环境中，应用的运行时间和内存消耗总是由enclave创建销毁以及ecall占大头。